<!DOCTYPE html>
<html>
	<head>
		<title>WEP simulation</title>
        	<link rel="stylesheet" type="text/css" href="Custom-Range-Slider-CSS-jQuery.css">
        	<link rel="stylesheet" type="text/css" href="style.css?ver=0.1">
		<script src="https://code.jquery.com/jquery-1.11.3.js"></script>
		<script type="text/javascript" src="init.js?ver=0.1"></script>
		<script type="text/javascript" src="string.js?ver=0.1"></script>
		<script type="text/javascript" src="wep.js?ver=0.1"></script>
		<script type="text/javascript" src="utility.js?ver=0.1"></script>
		<script type="text/javascript" src="slider.js?ver=0.1"></script>
		<script>
			var sharedKey_16 = '0000000000';
			var iv_16;
			var crc32_16;
			var crcTable;
			var plainText_16;
			var keyString_16;
			var cipher_16;

			var speed = 100;
			var stage = 1;
			
			$( window ).load(function() {
				setInit();
				inputSharedKey();
			});

			$( window ).resize(function() {
				setInit();
			});

			function WEP(){
				var start = $('.button_start');
				var request = $('.img_request');
				var message = $('.box_message');
				var client = $('.img_client');
				var target = $('.img_target');

				start.css('display','none');
				request.css('display','block');
				request.css('top',getCoord(client,'TOP'));
				request.animate({top:getCoord(target,'BOTTOM')-request.height()},25*speed,function(){
					stage++;
					request.css('display','none');
					message.css('display','block');
					message.css('top',getCoord(target,'BOTTOM')+10);
					message.css('left',getCoord(target,'HCENTER')-message.width()/2);
				});
			}
			function sendChallenge(){
				if($('.input_message').val() == ''){
					alert('보낼 메세지를 입력해주세요!');
					return ;
				}
				$('.attr_hide').css('display','block');
				$('.text_message').html($('.input_message').val());
				$('.box_message').css('display','none');
				
				var message = $('.img_message');		
				var client = $('.img_client');		
				var target = $('.img_target');
				var start = $('.button_start');

				message.css('display','block');
				message.css('left',getCoord(target,'HCENTER')-message.width()/2);
				message.css('top',getCoord(target,'VCENTER')-message.height()/2);
				message.animate({top:getCoord(client,'TOP')},25*speed,function(){
					stage++;
					start.val('암호화해서 보내기');
					start.css('left',getCoord(client,'HCENTER')-start.width()/2);
					start.css('display','block');
					start.attr('onclick', 'ani()');
				});
			}

			
		
			function ani(){
				var start = $('.button_start');
				var crc = $('.box_crc');
				var message = $('.img_message');
				var client = $('.img_client');

				start.css('display','none');
				crc.css('display','block');
				message.css('left',getCoord(client,'HCENTER') - message.width()/2);
				message.css('top',getCoord(client,'BOTTOM'));

				message.animate({top:getCoord(crc,'TOP')},10*speed,function(){ani_passCRC();});
			}
			function ani_passCRC(){
				var message = $('.img_message');
				var client = $('.img_client');
				var crc = $('.box_crc');

				message.animate({left:getCoord(crc,'HCENTER')-10},10*speed,function(){ani_withCRC();});
			}
			function ani_withCRC(){
				crcTable = makeCrcTable();
				makeCheckSum();

				var message = $('.img_message');
				var crc = $('.img_crc');
				var rc = $('.box_rc');

				crc.css('display', 'block');
				rc.css('display','block');
				crc.css('top', getCoord(message,'TOP'));
				crc.css('left', getCoord(message,'HCENTER') - crc.width()/2);

				crc.animate({top:getCoord($('.box_crc'),'BOTTOM')+20},15*speed);
				message.animate({top:getCoord($('.box_crc'),'BOTTOM')+25},15*speed,function(){ani_makeIV()});
			}
			function ani_makeIV(){
				var iv_2 = '';
				for(var i = 0; i < 24; i++)
					iv_2 += Math.floor(Math.random() * 2) + '';
				iv_16 = parseInt(iv_2, 2).toString(16);
				iv_16 = padding(iv_16,6);
				$('.text_iv_16').html(iv_16);
				$('.text_seed').html(iv_16 + sharedKey_16);
			
				var rc = $('.box_rc');
				var client = $('.img_client');
				var crc = $('.img_crc');
				var key = $('.img_key');
				var iv = $('.img_iv');
				var message = $('.img_message');

				iv.css('display','block');
				iv.css('left',getCoord(client,'HCENTER')-iv.width()/2);
				iv.css('top',getCoord(client,'VCENTER'));
				key.css('display','block');
				key.css('left',getCoord(client,'HCENTER')-key.width()/2);
				key.css('top',getCoord(client,'VCENTER')+iv.height());
				message.animate({left:getCoord(rc,'LEFT')-message.width()},25*speed);
				crc.animate({left:getCoord(rc,'LEFT')-message.width()},25*speed);
				iv.animate({top:getCoord(rc,'TOP')-key.height()-iv.height()},25*speed);
				key.animate({top:getCoord(rc,'TOP')-key.height()},25*speed,function(){ani_passRC()});
			}
			function ani_passRC(){
				var rc = $('.box_rc');
				var client = $('.img_client');
				var crc = $('.img_crc');
				var key = $('.img_key');
				var iv = $('.img_iv');
				var message = $('.img_message');

				message.animate({left:getCoord(rc,'LEFT')+rc.width()/2+10},15*speed);
				crc.animate({left:getCoord(rc,'LEFT')+rc.width()/2},15*speed);
				iv.animate({top:getCoord(rc,'TOP')},15*speed);
				key.animate({top:getCoord(rc,'TOP')+iv.height()},15*speed,function(){ani_withStr()});
			}
			function ani_withStr(){
				makeKeyString(plainText_16,iv_16 + sharedKey_16);

				var crc = $('.img_crc');
				var rc = $('.box_rc');
				var str = $('.img_str');
				var key = $('.img_key');
				var iv = $('.img_iv');
				var message = $('.img_message');

				key.css('display','none');
				iv.css('display','none');
				$('.box_xor').css('display','block');
				str.css('display','block');
				str.css('left',getCoord(rc,'LEFT'));
				str.css('top',getCoord(rc,'BOTTOM')-str.height());
				crc.css('left',getCoord(str,'RIGHT'));

				crc.animate({top:getCoord(rc,'BOTTOM')+17},15*speed);
				str.animate({left:getCoord(rc,'RIGHT')},15*speed);
				message.animate({top:getCoord(rc,'BOTTOM')+crc.height()+10},15*speed,function(){ani_towardXOR()});
			}
			function ani_towardXOR(){
				makeCipher(plainText_16,keyString_16);

				var message = $('.img_message');
				var rc = $('.obx_rc');
				var iv = $('.img_iv');
				var client = $('.img_client');
				var xor = $('.box_xor');
				var crc = $('.img_crc');
				var str = $('.img_str');

				xor.css('display','block');

				str.animate({left:getCoord(xor,'LEFT')},15*speed);
				crc.animate({left:getCoord(xor,'LEFT')-crc.width()},15*speed);
				message.animate({left:getCoord(xor,'LEFT')-message.width()},15*speed,function(){ani_passXOR()});
			}
			function ani_passXOR(){
				makeCipher(plainText_16,keyString_16);

				var message = $('.img_message');
				var rc = $('.obx_rc');
				var iv = $('.img_iv');
				var client = $('.img_client');
				var xor = $('.box_xor');
				var str = $('.img_str');
				var crc = $('.img_crc');

				xor.css('display','block');

				crc.animate({left:getCoord(xor,'LEFT')},15*speed);
				message.animate({left:getCoord(xor,'LEFT')},15*speed);
				str.animate({top:getCoord(xor,'TOP')},15*speed, function(){ani_encrypt();});
			}
			function ani_encrypt(){
				var iv = $('.img_iv');
				var enc = $('.img_enc'); 
				var client = $('.img_client');
				var crc = $('.img_crc');
				var str = $('.img_str');
				var xor = $('.box_xor');
				var message = $('.img_message');

				crc.css('display','none');
				str.css('display','none');
				message.css('display','none');
				iv.css('display','block');
				enc.css('display','block');
				enc.css('left',getCoord(xor,'RIGHT'));
				enc.css('top',getCoord(xor,'BOTTOM'));
				iv.css('left',getCoord(client,'RIGHT'));
				iv.css('top',getCoord(client,'VCENTER'));
				
				iv.animate({left:getCoord(xor,'RIGHT')+enc.width()/2},10*speed);
				enc.animate({left:getCoord(xor,'RIGHT')+enc.width()/2},10*speed,function(){ani_withEnc()});
			}
			function ani_withEnc(){
				var iv = $('.img_iv');
				var enc = $('.img_enc'); 

				iv.animate({top:getCoord(enc,'TOP')-iv.height()},8*speed,function(){ani_towardTarget();});
			}
			function ani_towardTarget(){
				var iv = $('.img_iv');
				var enc = $('.img_enc'); 

				iv.animate({top:getCoord(iv,'TOP')+100},10*speed);
				enc.animate({top:getCoord(enc,'TOP')+100},10*speed,function(){ani_towardTarget2();});
			}
			function ani_towardTarget2(){
				var iv = $('.img_iv');
				var enc = $('.img_enc'); 
				var client = $('.img_client');

				iv.animate({left:getCoord(client,'HCENTER')-iv.width()/2},10*speed);
				enc.animate({left:getCoord(client,'HCENTER')-enc.width()/2},10*speed,function(){ani_passTarget();});
			}
			function ani_passTarget(){
				var client = $('.img_client');
				var iv = $('.img_iv');
				var enc = $('.img_enc'); 
				var target = $('.img_target');
				var key = $('.img_key');  
				var start = $('.button_start');
				var crc = $('.box_crc');
				var xor = $('.box_xor');
				var rc = $('.box_rc');
				var message = $('.img_message');

				iv.animate({top:getCoord(target,'BOTTOM')-iv.height()-key.height()+10},8*speed);
				enc.animate({top:getCoord(target,'BOTTOM')-key.height()+10},8*speed,function(){
					stage++;
					setLocation(stage);
				
					iv.css('display','none');
					enc.css('display', 'none');
					start.val('복호화 및 연결 승인하기');
					start.css('left',getCoord(client,'HCENTER')-start.width()/2);
					start.css('display','block');
					start.attr('onclick', 'ani_towardRC()');
				});
			}
			function ani_towardRC(){
				var iv = $('.img_iv');
				var enc = $('.img_enc');
				var key = $('.img_key'); 
				var target = $('.img_target'); 
				var message = $('.img_message');
				var start = $('.button_start');
				var rc = $('.box_rc');

				rc.css('display','block');
				start.css('display','none');
				iv.css('display', 'block');
				enc.css('display', 'block');
				key.css('display','block');
				key.css('left',getCoord(target,'HCENTER')-key.width()/2);
				key.css('top',getCoord(target,'BOTTOM')-key.height()+10);
				iv.css('left',getCoord(target,'HCENTER')-iv.width()/2);

				iv.animate({top:getCoord(rc,'TOP')},10*speed);
				key.animate({top:getCoord(rc,'TOP')+iv.height()},10*speed,function(){ani_passRC2();});
			
				
			}		
			function ani_passRC2(){
				var iv = $('.img_iv');
				var key = $('.img_key'); 
				var rc = $('.box_rc');

				iv.animate({left:getCoord(rc,'LEFT')},10*speed);
				key.animate({left:getCoord(rc,'LEFT')},10*speed,function(){ani_withStr2();});
			}	
			function ani_withStr2(){
				var iv = $('.img_iv');
				var key = $('.img_key'); 
				var str = $('.img_str');
				var rc = $('.box_rc');
				var xor = $('.box_xor');
				var enc = $('.img_enc');

				iv.css('display','none');
				key.css('display','none');
				str.css('display','block');
				str.css('top',getCoord(rc,'TOP'));
				enc.css('display','block');
				xor.css('display','block');
			
				str.animate({top:getCoord(rc,'TOP')-rc.height()},15*speed,function(){ani_towardXOR2();});
			}
			function ani_towardXOR2(){
				var xor = $('.box_xor');
				var enc = $('.img_enc');
				var str = $('.img_str');
				
				enc.animate({top:getCoord(xor,'BOTTOM')+20},10*speed);
				str.animate({left:getCoord(xor,'RIGHT')+20},10*speed,function(){ani_passXOR2();});
			}
			function ani_passXOR2(){
				var enc = $('.img_enc');
				var str = $('.img_str');
				var xor = $('.box_xor');

				enc.animate({top:getCoord(xor,'BOTTOM')},15*speed);
				str.animate({left:getCoord(xor,'RIGHT')-str.width()+10},15*speed,function(){ani_withCRC2();});
			}
			function ani_withCRC2(){
				decryption(cipher_16,keyString_16);
			
				var enc = $('.img_enc');
				var str = $('.img_str');
				var xor = $('.box_xor');
				var crc = $('.img_crc');
				var message = $('.img_message');

				enc.css('display','none');
				str.css('display','none');
				$('.box_crc').css('display','block');
				crc.css('display','block');
				crc.css('left',getCoord(xor,'HCENTER')+10);
				crc.css('top',getCoord(xor,'VCENTER'));
				message.css('display','block');
				message.css('left',getCoord(xor,'LEFT'));
				message.css('top',getCoord(xor,'VCENTER'));

				message.animate({top:getCoord(message,'TOP')+message.height()-20},15*speed);
				crc.animate({top:getCoord(crc,'TOP')+crc.height()+20},15*speed,function(){ani_towardCRC();});
				
			}
			function ani_towardCRC(){
				var crc = $('.img_crc');
				var target = $('.img_target');
				var message = $('.img_message');
			
				crc.animate({top:getCoord(target,'BOTTOM')-crc.height()},10*speed);
				message.animate({left:getCoord($('.box_crc'),'HCENTER')-message.width()/2+10},10*speed,function(){ani_passCRC2();});
				
			}
			function ani_passCRC2(){
				var crc = $('.img_crc');
				var message = $('.img_message');

				crc.css('display','none');

				message.animate({top:getCoord($('.box_crc'),'TOP')},10*speed,function(){ani_towardTarget3();});
				
			}
			function ani_towardTarget3(){
				var crc = $('.img_crc');
				var target = $('.img_target');
				var message = $('.img_message');

				message.css('display','none');
				crc.css('display','block');

				crc.css('left',getCoord($('.box_crc'),'HCENTER')-crc.width()/2+10);
				crc.css('top',getCoord($('.box_crc'),'BOTTOM')+20);

				crc.animate({top:getCoord(target,'BOTTOM')-crc.height()},10*speed,function(){ani_towardTarget4();});
			}
			function ani_towardTarget4(){
				var crc = $('.img_crc');
				var target = $('.img_target');
				var start = $('.button_start');
				var xor = $('.box_xor');
				var rc = $('.box_rc');
				var client = $('.img_client');

				crc.animate({left:getCoord(target,'LEFT')},10*speed,function(){ani_end();});
			}
			function ani_end(){
				$('.text_checkSum').html('OK!');
	
				var ok = $('.img_ok');
				var crc = $('.img_crc');
				var client = $('.img_client');
				var target = $('.img_target');
				var start = $('.button_start');
				var xor = $('.box_xor');
				var rc = $('.box_rc');

				rc.css('display','none');
				crc.css('display','none');
				xor.css('display','none');
				$('.box_crc').css('display','none');
				ok.css('display','block');
				ok.css('top',getCoord(target,'BOTTOM')-ok.height());
				ok.animate({top:getCoord(client,'TOP')},25*speed,function(){
					ok.css('display','none');
					start.css('display','block');
					start.val('다시 시작');
					start.css('left',getCoord(client,'HCENTER')-start.width()/2);
					start.attr('onclick', 'window.location.reload()');
				});
			}
		</script>
	</head>
	<body>
		<div class="side">
			<h3>WEP키</h3>
			<b>공유키(16진수)</b><br>	
			<span class="text_sharedKey_16">0000000000</span><br>
			<div class="attr_hide">
				<b>IV(16진수)</b><br>	
				<span class="text_iv_16"></span><br>
				<b>IV + 공유키(16진수)</b><br>	
				<span class="text_seed"></span><br>
				<hr>
				<h3>메세지</h3>
				<b>내용</b><br>	
				<span class="text_message"></span><br>
				<b>CRC32(16진수)</b><br>
				<span class="text_crc32"></span><br>
				<b>메세지 + CRC32(16진수)</b><br>
				<span class="text_plain"></span><br>
				<hr>
				<h3>암호화</h3>
				<b>키 스트링(16진수)</b><br>	
				<span class="text_keyStr"></span><br>
				<b>암호문(16진수)</b><br>
				<span class="text_cipher"></span><br>
				<hr>
				<h3>복호화</h3>
				<b>메세지</b><br>	
				<span class="text_decrypt"></span><br>
				<b>Check Sum 확인</b><br>
				<span class="text_checkSum"></span><br>
			</div>
			<hr>
			<div class= "range-slider">
				<b>속도:&nbsp;</b>
  				<input class="range-slider__range" type="range" value="100" min="20" max="200" step="20">
				<br>
				<span><br>(속도는 다음 애니메이션 구간부터 적용이 됩니다)</span>
			</div>
			<script>setSlider();</script>
		</div>
		<div class="main">
			<img class="img_client" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f4f1.png">
			<img class="img_target" src="ap.png"><br>
			<div class="box_message">
				<input class="input_message" type="text">
				<input class="button_message" type="button" value="첼린지 보내기" onclick="sendChallenge()">
			</div>
			<input class="button_start" type="button" value="AP에게 연결 요청" onclick="WEP()">
			<img class="img_request" src="req.png">
			<img class="img_message" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2709.png">
			<div class="box_crc">CRC32 BOX</div>
			<div class="img_crc">CRC32</div>
			<div class="box_rc">RC4 BOX</div>
			<img class="img_key" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f510.png">
			<div class="img_iv">IV</div>
			<div class="box_xor">XOR BOX</div>
			<div class="img_str">K_STR</div>
			<div class="img_enc">ENC</div>
			<img class="img_ok" src="ok.png">
		</div>
	</body>
</html>